<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="This is custom made Coding Ninjas production link checker written in JS and php.">
    <link rel="icon" type="image/png" sizes="16x16" href="images/cn.png">
    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700,900" rel='stylesheet' type='text/css'>
    <title>Review | Production Link</title>
    <!-- Vendor styles 
    <link rel="stylesheet" href="vendor/fontawesome/css/font-awesome.css"/>
    <link rel="stylesheet" href="vendor/animate.css/animate.css"/>-->
    <link rel="stylesheet" href="vendor/bootstrap/css/bootstrap.css"/>
</head>
<!-- Body-->
<body class="back-row-toggle splat-toggle">
    <section class="content">
        <div class="col-md-12">
            <h10 id="time" style="text-align: left; font-size: 0.5em;"></h10>
            <div class="panel panel-filled">
                <div class="panel-body">
                    <div>
                        <div class="col-lg-12">
                        </div><br>
                        <center>
                            <textarea maxlength="14500000000000" id="list" placeholder="" class="form-control" style="resize: none;outline: none; width: 80%;height:150px;"></textarea>
                            <br>
                            <button type="button" id="start_test" onclick="submit()" class="btn btn-outline-primary">Start</button>&nbsp;
                            <button type="button" onclick="stop()" id="stop_test" class="btn btn-outline-dark">Stop</button>
                            <br><br>
                            <small>
                                <span class="bagde badge-pill badge-light"><strong>STATUS</strong></span>
                                &nbsp;REVIEWED&nbsp;<span id="cDead" class="badge badge-primary">0</span>&nbsp;LOADED&nbsp;<span id="loaded" class="badge badge-dark">0</span>
                            </small>
                        </center>
                        <br>
                    </div>
                    <button type="button" id="showdec" onclick="changed_state('bodedec');" class="btn btn-primary">Reviewed&nbsp;<span id="cDead2">0</span></button>
                    <div id="bodedec" style="display:block;">
                        <span id=".declined" class="declined"></span>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.js" type="text/javascript"></script>
    
    <script title="CHECKER AJAX">
        function submit() {
            var line = $("#list").val();
            var send = line.split("\n");
            var total = send.length;
            var rev = 0;
            send.forEach(function(value, index) {
                const slug = value.split('/').pop();

                const requestOptions = {
                    method: "GET",
                    headers: {
                        "Accept": "application/json, text/plain, */*",
                        "Origin": "https://www.codingninjas.com",
                        "Referer": "https://www.codingninjas.com/"
                    }
                };

                const url = `https://api.codingninjas.com/api/v3/public_section/resource_details?slug=${slug}`;

                fetch(url, requestOptions)
                .then(response => {
                    return response.json();
                })
                .then(data => {
                    const articleId = data.data.article.id;
                    const articleTitle = data.data.article.title;
                    let faqs = data.data.article.static_data.faqs;
                    const metaDescription = data.data.article.static_data.meta_description;
                    const articleImageUrl = data.data.article.static_data.article_image_url;
                    const content = data.data.article.content;
                    const authorId = data.data.article.author.id;
                    const authorUuid = data.data.article.author.uuid;
                    const authorName = data.data.article.author.name;
                    const authorImage = data.data.article.author.image;
                    const authorScreenName = data.data.article.author.screen_name;
                    const slug = data.data.article.slug;
                    const updatedAt = data.data.article.updated_at;
                    const publishedAt = data.data.article.published_at;
                    const publishStatus = data.data.article.publish_status;
                    const upvoteCount = data.data.article.upvote_count;
                    const isUpvoted = data.data.article.is_upvoted;
                    const difficultyLevel = data.data.article.difficulty_level;
                    const breadcrumbs = data.data.article.breadcrumbs;
                    let placedCategory = breadcrumbs[breadcrumbs.length - 2];
                    if(placedCategory != undefined) {
                        placedCategory = placedCategory.name;
                    }

                    faqs = JSON.stringify(faqs);

                    var payload = {
                        articleId: articleId,
                        articleTitle: articleTitle,
                        faqs: faqs,
                        metaDescription: metaDescription,
                        articleImageUrl: articleImageUrl,
                        content: content,
                        authorId: authorId,
                        authorUuid: authorUuid,
                        authorName: authorName,
                        authorImage: authorImage,
                        authorScreenName: authorScreenName,
                        slug: slug,
                        updatedAt: updatedAt,
                        publishedAt: publishedAt,
                        publishStatus: publishStatus,
                        upvoteCount: upvoteCount,
                        isUpvoted: isUpvoted,
                        difficultyLevel: difficultyLevel,
                        placedCategory: placedCategory
                    };

                    var xhr = new XMLHttpRequest();
                    xhr.open('POST', 'process.php', true);
                    xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
                    
                    xhr.onreadystatechange = function() {
                        if (xhr.readyState === XMLHttpRequest.DONE) {
                            if (xhr.status === 200) {
                                var response = xhr.responseText;
                                declined(response);
                                removeline();
                                decln++;
                                var ttl = parseInt(decln);
                                $('#cDead').html(decln);
                                $('#total').html(ttl);
                                $('#loaded').html(total);
                                $('#cDead2').html(decln);
                            } 
                            else {
                                console.log('Error: ' + xhr.status);
                            }
                        }

                    };
                    
                    xhr.send('data=' + encodeURIComponent(JSON.stringify(payload)));
                })
                .catch(error => {
                    console.log(error);
                });
            });
        }
        function reviewed(str) {
            $(".declined").append(str + "<br>");
        }
        function removeline() {
            var lines = $("#list").val().split('\n');
            lines.splice(0, 1);
            $("#list").val(lines.join("\n"));
        }
    </script>
    <script type="text/javascript">
        function changed_state(el) {
            var display = document.getElementById(el).style.display;
            if (display === "none")
                document.getElementById(el).style.display = 'block';
            else
                document.getElementById(el).style.display = 'none';
        }

    </script>

    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.5.11/js/mdb.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script>
        var myVar = setInterval(function() {
            myTimer()
        }, 1000);
        function myTimer() {
            var d = new Date();
            document.getElementById("time").innerHTML = d;
        }
    </script>
    <style>
        ::-webkit-input-placeholder {
            text-align: center;
        }
        :-moz-placeholder {
            text-align: center;
        }
        ::-moz-placeholder {
            text-align: center;
        }
        :-ms-input-placeholder {
            text-align: center;
        }
        ::-webkit-scrollbar {
            width: 2px;
            height: 2px;
            background-color: #3a3c46;
        }
        ::-webkit-scrollbar-track {
            border-radius: 30px;
            -webkit-box-shadow: inset 0 0 6px #3b3c46;
            background-color: #3b3c46;
        }
        ::-webkit-scrollbar-thumb {
            border-radius: 30px;
            background-color: #949ba2;
        }
    </style>
</body>
</html>
